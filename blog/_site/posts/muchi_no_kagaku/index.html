<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ryotaro SAKAMOTO">
<meta name="dcterms.date" content="2024-09-07">

<title>blog - 知ってるつもり　無知の科学</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">知ってるつもり　無知の科学</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">reading</div>
                <div class="quarto-category">psychology</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ryotaro SAKAMOTO </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 7, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="知ってるつもり-無知の科学" class="level1">
<h1>知ってるつもり　無知の科学</h1>
<p>著者: スティーブン・スローマン　フィリップ・ファーンバック</p>
<p>評価: ⭐️⭐️⭐️⭐️ ステータス: 読了 種別: 書籍 読了日: April 10, 2023 → April 14, 2023</p>
<p><img src="https://m.media-amazon.com/images/I/41umdmCIC+L._SX336_BO1,204,203,200_.jpg" class="img-fluid"></p>
<p><strong>目次</strong></p>
</section>
<section id="感想" class="level1">
<h1>感想</h1>
<p>内容は良かったと思うが、長い。「世界は複雑すぎて一人では理解しきれないが、大抵の人は自分の理解度に関して錯覚している。自分が知識のコミュニティ（環境内の情報や他者の知識を指す）の中に生きているということを理解することで、よりよい意思決定ができるのではないか」というのが要旨。ただ、ためになったところもあるので、簡単なメモは残しておく。</p>
</section>
<section id="要約" class="level1">
<h1>要約</h1>
<section id="序論-個人の無知と知識のコミュニティ" class="level2">
<h2 class="anchored" data-anchor-id="序論-個人の無知と知識のコミュニティ">序論　個人の無知と知識のコミュニティ</h2>
<p><strong>私たちは思ったよりも無知</strong></p>
<ul>
<li>ビキニ環礁の核実験「キャッスル・ブラボー」</li>
<li>リトルボーイの300倍を想定していたが、実際は1000倍　← リチウム7の性質の読み違い</li>
<li>トイレの仕組みを説明できるか？
<ul>
<li>トイレはサイホン式といってボウル→トラップ→下水道と水が流れる仕組み</li>
<li>のちに出てくる「説明深度の錯覚」</li>
</ul></li>
</ul>
<p><strong>思考はなんのためか？</strong></p>
<ul>
<li><p>思考は行動の延長</p>
<p>← 思考しない生物でも行動はする。行動が先にあり、最適行動をとるための能力として、思考が進化したと考えるのが自然。</p></li>
</ul>
<p>知識のコミュニティ</p>
<ul>
<li>私たちは、一人では何にもわからん（日常で使用するトイレの構造、自転車の構造すらも）</li>
<li>科学の進歩も、一人の偉人によって成立するわけではない</li>
</ul>
</section>
<section id="章-知っているのウソ" class="level2">
<h2 class="anchored" data-anchor-id="章-知っているのウソ">1章　「知っている」のウソ</h2>
<p>無謀なマイナスドライバーでの実験</p>
<p><a href="https://dic.nicovideo.jp/a/%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%83%BB%E3%82%B3%E3%82%A2">https://dic.nicovideo.jp/a/デーモン・コア</a></p>
<p><strong>説明深度の錯覚</strong></p>
<p>Rozenblit L, Keil F. The misunderstood limits of folk science: an illusion of explanatory depth. Cogn Sci. 2002 Sep 1;26(5):521-562. doi: 10.1207/s15516709cog2605_1. PMID: 21442007; PMCID: PMC3062901. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3062901/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3062901/</a></p>
<ol type="1">
<li>ファスナーの仕組みをどれくらい理解している？　1〜7で答えて。</li>
<li>どんな仕組みか説明してもらえる？</li>
<li>もう一度、ファスナーの仕組みを理解しているか教えて？</li>
</ol>
<p>このパラダイムによって、説明深度の錯覚を検証できるのではと気づいた。</p>
<p>一番わかりやすい説明深度の錯覚の例が以下の論文。</p>
<p>身近に使っている自転車ですら、構造をよく把握できていない。</p>
<ul>
<li>前輪と後輪にチェーンつけたら曲がれないじゃん…</li>
</ul>
<p>Lawson, R. The science of cycology: Failures to understand how everyday objects work.&nbsp;<em>Memory &amp; Cognition</em> <strong>34</strong>, 1667–1675 (2006). https://doi.org/10.3758/BF03195929</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Untitled.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Untitled</figcaption>
</figure>
</div>
</section>
<section id="章-なぜ思考するのか" class="level2">
<h2 class="anchored" data-anchor-id="章-なぜ思考するのか">2章　なぜ思考するのか</h2>
<p>抽象的で本質的な情報を得るため。</p>
<p>ハエトリグサ：脳がないが、「短時間で2回葉に触ると閉じる」というメカニズム</p>
<p>→ 多少のエラーはカバーできるが、対応力皆無</p>
<p>クラゲ：800のニューロン</p>
<p>→ 捕食行動、環境への適応等、ハエトリグサよりも高度な行動。</p>
<p>カブトガニ：</p>
<p>視覚情報が体系的に修正される。それは、雌個体に近いものを見つけるのに最適化。</p>
<p>面白いのがカラパイアにあるので、カブトガニは検索の価値あり。</p>
<p>超記憶症候群　「記憶の人、フネス」by ボルヘス</p>
<p>個別的な情報を蓄積することは、特に意味がない。</p>
<p>→ うつ病や特有の苦しみ</p>
</section>
<section id="章-どう思考するのか" class="level2">
<h2 class="anchored" data-anchor-id="章-どう思考するのか">3章　どう思考するのか</h2>
<p>論理的な推論に長けている訳ではないが、因果推論に長けている。e.g.&nbsp;) ウェイソン4枚カード問題々</p>
<p>前向き推論と後ろ向き推論がある</p>
<p>後ろ向き推論がそこまで得意でもないが、他の生物でできる事例はない。</p>
<p>後ろ向き推論が難しいということは他でも見たことがある。</p>
<p>→ 原因から結果よりも、結果から原因の候補を挙げる方がはるかに難しい。</p>
</section>
<section id="章-なぜ間違った考えを抱くのか" class="level2">
<h2 class="anchored" data-anchor-id="章-なぜ間違った考えを抱くのか">4章　なぜ間違った考えを抱くのか</h2>
<p>因果推論に長けていると3章で紹介したが、実は因果推論も完璧ではない。</p>
<ul>
<li>素朴因果モデルのようなものを持っており、それを適用する
<ul>
<li>そのため、間違いが生じるケースもある</li>
<li>ただし、世界をだいたい把握するためには<strong>必要十分</strong></li>
</ul></li>
</ul>
<p>因果推論には二種類ある。</p>
<p>→ システム1とシステム2（直感と熟慮）</p>
<p>説明深度の錯覚を生むのは、直感の部分。</p>
<ul>
<li>直感が、最初に単純かつ必要十分な分析を提示することで、わかった気になる</li>
<li>その後、熟慮システムが働くと、意外とわかっていなかったことに気づく。</li>
</ul>
</section>
<section id="章-体と世界を使って考える" class="level2">
<h2 class="anchored" data-anchor-id="章-体と世界を使って考える">5章　体と世界を使って考える</h2>
<p>すべてを計算してから行動するか、環境情報を使いながら行動するか？</p>
<ul>
<li>AI
<ul>
<li><p>すべての知識を持ち、すべての演算を行ってから動く古き良きAI</p>
<p>→ これだと、歩行とかほぼ不可能</p></li>
<li><p>知能を具現化したAI（ルンバ）</p>
<p>環境の情報に対応して、自律的に対応するバネなどが足についている。</p>
<p>リアルタイムに環境に合わせて動く</p></li>
</ul></li>
<li>人間</li>
</ul>
<p>「野球のフライボールを取る時」</p>
<ul>
<li>弾道を計算するのではなく、地面と視線の間の角度が一定のペースで増加するように前後に動くと、上手く取れる</li>
</ul>
<p>「ドアサイズの隙間に入る時」</p>
<ul>
<li><p>オプティカルフローを利用する。</p></li>
<li><p>両側のドア枠が自分に同じ速度で近づいてくるように意識しながら進む</p>
<p>（片側のオプティカルフローを操作してあげると、ヒトもミツバチも上手く入れない）</p></li>
</ul>
<p>環境に情報が存在し、それを利用する。</p>
<p>頭でっかちな演算装置ではない！！</p>
</section>
<section id="章-他者を使って考える" class="level2">
<h2 class="anchored" data-anchor-id="章-他者を使って考える">6章　他者を使って考える</h2>
<p>私たちは、他者と共同することで高い成果を挙げることができる一方、</p>
<ul>
<li>他者のもつ知識を自分のものと勘違いする錯覚</li>
<li>（裏返しとして）自分が知ってる知識を相手も知っていると勘違いする「知識の呪縛」</li>
</ul>
</section>
<section id="章-テクノロジーを使って考える" class="level2">
<h2 class="anchored" data-anchor-id="章-テクノロジーを使って考える">7章　テクノロジーを使って考える</h2>
<p>テクノロジーは人間がこれまでも狩猟採集で使用してきたため、特に不自然はない。</p>
<p>問題は、</p>
<ul>
<li>テクノロジーがかつてないほど複雑化していること</li>
<li>人間と志向性を共有していないこと</li>
</ul>
<p>テクノロジーは良い面もある。e.g., クラウドソーシング</p>
<p>新たな知識のコミュニティの誕生</p>
</section>
<section id="章-科学について考える" class="level2">
<h2 class="anchored" data-anchor-id="章-科学について考える">8章　科学について考える</h2>
<p>科学に対する国民の理解はそこまで高くない。</p>
<p>e.g., ワクチン接種の反対</p>
<p>e.g., 遺伝子組み換え作物への反対</p>
<p>「ボドマー・レポート」</p>
<p><strong>欠乏モデル＝知識が足りていない→理解がない、逆にいうと、知識を与えれば科学に対する理解は進むという考え</strong></p>
<p>→ 世界中の科学者が国民の科学への理解を調べるきっかけになった</p>
<p>しかし、一般大衆を啓蒙する試みはずっと行われてきたが、特にリテラシーあがってなくない？？</p>
<p>欠乏モデルのRCT(randomized control trial)の有名な論文。</p>
<p>Nyhan, B., Reifler, J., Richey, S., &amp; Freed, G. L. (2014). Effective messages in vaccine promotion: a randomized trial.&nbsp;<em>Pediatrics</em>,&nbsp;<em>133</em>(4), e835–e842. https://doi.org/10.1542/peds.2013-2365</p>
<p><a href="https://pubmed.ncbi.nlm.nih.gov/24590751/" class="uri">https://pubmed.ncbi.nlm.nih.gov/24590751/</a></p>
<ol type="1">
<li>ワクチンを受けないことによるマイナスの影響を見せる</li>
<li>風疹、おたふくかぜ、麻疹にかかったこどもの写真</li>
<li>麻疹にかかった子供についての痛ましい物語を読む</li>
<li>ワクチンと自閉症の関係を否定する確かな情報源からの情報</li>
</ol>
<p>→ 衝撃の結果。どの情報を見た被験者群でもワクチン接種をすると答える人は増えなかった。さらに2のケースでは、逆の効果が見られた。</p>
<p>欠乏モデルが間違っているのでは？？</p>
<p>科学に対する理解は、客観的知識の合理的な評価に基づくものではなく、さまざまな社会的・文化的要因で規定</p>
<p>→ その一つが「コミュニティへの忠誠心」</p>
<p>私たちの信念は、価値観やアイデンティティと関わり合い、コミュニティと共有されていることも多い。しかも、頭の中の因果モデルは限定的で、間違っていることも多い。</p>
<p>→ 反科学思想を持つ人もいる。</p>
<p>しかし、メカニズム（例えば地球温暖化の発生プロセス）について本当に短い動画を見てもらうだけでも、理解度と需要度は高まるという結果もある。</p>
<p>→ 長すぎず、短すぎない、プロセスベースの説明。</p>
<p>欠乏モデルを諦めずとも、科学の理解を進めることはできるんじゃないの？？</p>
</section>
<section id="章-政治について考える" class="level2">
<h2 class="anchored" data-anchor-id="章-政治について考える">9章　政治について考える</h2>
<p>政治についての意見は表明するものの、みんな政策の内容についてはよくわかってない。</p>
<ul>
<li>オバマケア</li>
<li>遺伝子組み換え食品の是非（反対した人はまさかにDNAを含む食品にまで反対）</li>
</ul>
<p>「情熱的に支持される意見には、きまってまともな根拠は存在しないものだ」byラッセル</p>
<p>「民主主義を否定する根拠を得たいなら、平均的な有権者と5分話してみれば良い」</p>
<p>「民主主義は最悪の統治形態である。ただし、他のすべての形態を除けば」by チャーチル</p>
</section>
<section id="章-賢さの定義が変わる" class="level2">
<h2 class="anchored" data-anchor-id="章-賢さの定義が変わる">10章　賢さの定義が変わる</h2>
<p>偉人はとてつもなく賢かったのか？</p>
<p>科学的な発見は、偉人一人によって発見されたような論調があるが、実際には科学コミュニティ全体で発見することの方が多い。</p>
<p>知能が高いのが優れているのか？</p>
<ul>
<li>確かに知能を示すg因子は、さまざまなテストの点数と相関がある。</li>
<li>しかし、発見やプロジェクトは、チーム単位で行う。
<ul>
<li>チームにどれだけ貢献できるのかという観点が欠落</li>
</ul></li>
</ul>
</section>
<section id="章-賢い人を育てる" class="level2">
<h2 class="anchored" data-anchor-id="章-賢い人を育てる">11章　賢い人を育てる</h2>
<p>教育の目的は、他者に頼っていた知識や行動を自分で身につけるため、知的独立であるという考え方は、不完全である。</p>
<p>世界には知るべきことが多すぎるため、知識は必ず他者に頼る部分があるということを見落としている。</p>
<p>→ 「他者の知識や能力を活用する方法」、「自分が何を知らないのかを知ること」が教育のもう一つの重要な目的</p>
<p>この視点が翻って教育にどのような影響を与えることができるか？</p>
<p>e.g., コロンビア大学の授業「無知」</p>
<p>e.g., ジグソーメソッド</p>
<p>各人が異なる専門知識を持ち、それを持ち合わせて答えを見つける教育法</p>
</section>
<section id="章-賢い判断をする" class="level2">
<h2 class="anchored" data-anchor-id="章-賢い判断をする">12章　賢い判断をする</h2>
<p>金融ローンの選択等々、情報量が多ければ相手に伝わる訳ではない。</p>
<p>むしろ、大抵のヒトは説明嫌いであり、まとまった説明の方を好む。</p>
<p>賢い選択を「ナッジ」するといった工夫が必要になる（リバタリアン・パターナリズム）</p>
<p>← 私たちの知識ではなく、環境の方に情報を埋め込んであげる。</p>
<p><strong>※ これは、私たちの知識が限られていることや、コミュニティに生きることを踏まえると、限りなく有効な手段のような気がする。</strong></p>
<ol type="1">
<li>噛み砕く</li>
<li>意思決定のための簡単なルールを作る</li>
<li>ジャスト・イン・タイム教育（必要な時にのみ教育をする）</li>
<li>自分の理解度を確認する</li>
</ol>
</section>
<section id="結び-無知と錯覚を評価する" class="level2">
<h2 class="anchored" data-anchor-id="結び-無知と錯覚を評価する">結び　無知と錯覚を評価する</h2>
<p>無知と錯覚は必ずしも悪いものではない。</p>
<ul>
<li>無知：「ダニング・クルーガー効果」（初級者は何が足りないのかわからないため、できると錯覚し、高い肯定感を覚える）</li>
<li>錯覚：挑戦することにつながる可能性</li>
</ul>
<p>ただし、自分もしくは自分のコミュニティが行った意思決定に責任が伴うのも事実。</p>
<p>→ 無知や錯覚が歓迎するべきものではない。</p>
<ul>
<li>自身の無知を認めること</li>
<li>間違った判断をしないコミュニティに属すること</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>