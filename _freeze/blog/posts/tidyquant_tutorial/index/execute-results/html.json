{
  "hash": "4b83a01531b2c6a76aa4c4f2f0489919",
  "result": {
    "markdown": "---\ntitle: \"tidyquantを使ってみる\"\nauthor: \"Ryotaro SAKAMOTO\"\nsubtitle: \"文献がすくない...\"\ndate: \"2024-12-18\"\ncategories: [R, economics]\ndraft: false\n---\n\n\nRで株価分析ができるtidyquantというライブラリがあるらしい。 このライブラリの特徴としては、\n\n-   {xts}, {zoo}, {quantmod}, {TTR}, {PerformanceAnalysis}の関数を活用したライブラリ\n-   tidyverseと親和性が高い\n\n網羅的に紹介してくれている文献（英語）があるので、この記事では自分が今後使えそうな関数に限って紹介する。\n\n<https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ01-core-functions-in-tidyquant.html>\n\n<https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ02-quant-integrations-in-tidyquant.html>\n\n<https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ05-performance-analysis-with-tidyquant.html>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyquant)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistered S3 method overwritten by 'quantmod':\n  method            from\n  as.zoo.data.frame zoo \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'quantmod' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'TTR' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'PerformanceAnalytics' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyquant packages ──────────────────────── tidyquant 1.0.9 ──\n✔ PerformanceAnalytics 2.0.4      ✔ TTR                  0.24.4\n✔ quantmod             0.4.26     ✔ xts                  0.14.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyquant_conflicts() ──\n✖ zoo::as.Date()                 masks base::as.Date()\n✖ zoo::as.Date.numeric()         masks base::as.Date.numeric()\n✖ PerformanceAnalytics::legend() masks graphics::legend()\n✖ quantmod::summary()            masks base::summary()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyverse' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.3     ✔ purrr   1.0.2\n✔ tibble  3.2.1     ✔ dplyr   1.1.3\n✔ tidyr   1.2.0     ✔ stringr 1.4.0\n✔ readr   2.1.2     ✔ forcats 1.0.0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tibble' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'purrr' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dplyr' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'forcats' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::first()  masks xts::first()\n✖ dplyr::lag()    masks stats::lag()\n✖ dplyr::last()   masks xts::last()\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggthemes)\n```\n:::\n\n\n基礎的な関数\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntq_index_options()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"DOW\"       \"DOWGLOBAL\" \"SP400\"     \"SP500\"     \"SP600\"    \n```\n:::\n\n```{.r .cell-code}\ntq_index(\"SP500\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nGetting holdings for SP500\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 503 × 8\n   symbol company      identifier sedol weight sector shares_held local_currency\n   <chr>  <chr>        <chr>      <chr>  <dbl> <chr>        <dbl> <chr>         \n 1 AAPL   APPLE INC    037833100  2046… 0.0763 -        184285585 USD           \n 2 MSFT   MICROSOFT C… 594918104  2588… 0.0653 -         90093568 USD           \n 3 NVDA   NVIDIA CORP  67066G104  2379… 0.0646 -        298170415 USD           \n 4 AMZN   AMAZON.COM … 023135106  2000… 0.0419 -        113217550 USD           \n 5 META   META PLATFO… 30303M102  B7TL… 0.0261 -         26479184 USD           \n 6 TSLA   TESLA INC    88160R101  B616… 0.0243 -         33627847 USD           \n 7 GOOGL  ALPHABET IN… 02079K305  BYVY… 0.0222 -         71010080 USD           \n 8 AVGO   BROADCOM INC 11135F101  BDZ7… 0.0204 -         56414855 USD           \n 9 GOOG   ALPHABET IN… 02079K107  BYY8… 0.0183 -         58211687 USD           \n10 BRK-B  BERKSHIRE H… 084670702  2073… 0.0165 -         22200782 USD           \n# ℹ 493 more rows\n```\n:::\n\n```{.r .cell-code}\ntq_exchange_options()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"AMEX\"   \"NASDAQ\" \"NYSE\"  \n```\n:::\n:::\n\n\n## tq_get\n\n基本的にはyahoo financeからデータを取得するが、ソースを個々に設定することができる。bloombergもある。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 取得可能データ一覧\ntq_get_options()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"stock.prices\"       \"stock.prices.japan\" \"dividends\"         \n [4] \"splits\"             \"economic.data\"      \"quandl\"            \n [7] \"quandl.datatable\"   \"tiingo\"             \"tiingo.iex\"        \n[10] \"tiingo.crypto\"      \"alphavantager\"      \"alphavantage\"      \n[13] \"rblpapi\"           \n```\n:::\n:::\n\n\n株価\n\n\n::: {.cell}\n\n```{.r .cell-code}\nappl_prices <- tq_get(\"AAPL\", get = \"stock.prices\", from = \"1990-01-01\")\nappl_prices\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8,811 × 8\n   symbol date        open  high   low close    volume adjusted\n   <chr>  <date>     <dbl> <dbl> <dbl> <dbl>     <dbl>    <dbl>\n 1 AAPL   1990-01-02 0.315 0.335 0.312 0.333 183198400    0.262\n 2 AAPL   1990-01-03 0.339 0.339 0.335 0.335 207995200    0.264\n 3 AAPL   1990-01-04 0.342 0.346 0.333 0.336 221513600    0.265\n 4 AAPL   1990-01-05 0.337 0.342 0.330 0.337 123312000    0.266\n 5 AAPL   1990-01-08 0.335 0.339 0.330 0.339 101572800    0.267\n 6 AAPL   1990-01-09 0.339 0.339 0.330 0.336  86139200    0.265\n 7 AAPL   1990-01-10 0.336 0.336 0.319 0.321 199718400    0.253\n 8 AAPL   1990-01-11 0.324 0.324 0.308 0.308 211052800    0.243\n 9 AAPL   1990-01-12 0.306 0.310 0.301 0.308 171897600    0.243\n10 AAPL   1990-01-15 0.308 0.319 0.306 0.306 161739200    0.241\n# ℹ 8,801 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nappl_prices |> ggplot(aes(x=date,y=adjusted)) + geom_line(color = \"brown\") + theme_economist_white()+labs(x=\"Date\",y=\"\",title= \"AAPL Stock Price\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nFANG\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,032 × 8\n   symbol date        open  high   low close    volume adjusted\n   <chr>  <date>     <dbl> <dbl> <dbl> <dbl>     <dbl>    <dbl>\n 1 META   2013-01-02  27.4  28.2  27.4  28    69846400     28  \n 2 META   2013-01-03  27.9  28.5  27.6  27.8  63140600     27.8\n 3 META   2013-01-04  28.0  28.9  27.8  28.8  72715400     28.8\n 4 META   2013-01-07  28.7  29.8  28.6  29.4  83781800     29.4\n 5 META   2013-01-08  29.5  29.6  28.9  29.1  45871300     29.1\n 6 META   2013-01-09  29.7  30.6  29.5  30.6 104787700     30.6\n 7 META   2013-01-10  30.6  31.5  30.3  31.3  95316400     31.3\n 8 META   2013-01-11  31.3  32.0  31.1  31.7  89598000     31.7\n 9 META   2013-01-14  32.1  32.2  30.6  31.0  98892800     31.0\n10 META   2013-01-15  30.6  31.7  29.9  30.1 173242600     30.1\n# ℹ 4,022 more rows\n```\n:::\n:::\n\n\n## tq_transmute()\n\n-   select:ピックアップして変形する列\n-   mutate_fun: 変形方法 e.g., to.monthly, to.period\n-   indexAt:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nFANG |> \n    group_by(symbol) |> \n    tq_transmute(select = adjusted, mutate_fun = to.monthly, indexAt = \"lastof\") |> ggplot() + geom_line(aes(x=date, y=adjusted,color=symbol))  + theme_economist_white() +\n    labs(\n        title = \"FANG Stock Prices (Monthly Adjusted)\",\n        x = \"\",\n        y = \"\",\n        color = \"Symbol\",\n        legend.position = \"right\"\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}